# Rocky Linux 프로메테우스(Prometheus) 설치 가이드

이 문서는 Rocky Linux 환경에서 프로메테우스를 설치하고 운영하기 위한 절차를 설명합니다.

---

## 1. 프로메테우스(Prometheus)란?
프로메테우스는 오픈소스 시스템 모니터링 및 알람 툴킷입니다. 대상 서버나 애플리케이션으로부터 메트릭(수치 데이터)을 수집하여 시계열 데이터(Time-series data) 형태로 저장합니다.

*   **주요 기능**: 다차원 데이터 모델, 유연한 쿼리 언어(PromQL), HTTP 기반의 풀(Pull) 방식 데이터 수집.
*   **용도**: CPU/메모리 사용량, 응답 속도, 서비스 상태 등 시스템의 전반적인 지표 모니터링.

## 2. 전용 사용자 생성 이유
시스템 보안과 안정성을 위해 `prometheus`라는 전용 사용자를 생성합니다.

*   **보안성**: 서비스가 해킹당하더라도 해커가 시스템 전체 권한(root)을 얻지 못하도록 제한합니다.
*   **격리성**: 프로메테우스가 시스템의 다른 중요 파일을 수정하거나 삭제하는 실수를 방지합니다.
*   **로그인 제한**: 서비스 실행 전용 계정으로 생성하여, 외부인이 이 계정으로 서버에 로그인하는 것을 차단합니다.

## 3. 설치 단계

### 3.1 시스템 사용자 및 그룹 생성
보안을 위해 홈 디렉토리가 없고 로그인이 불가능한 전용 계정을 생성합니다.

```bash
sudo useradd --no-create-home --shell /bin/false prometheus
```

### 3.2 디렉토리 생성
설정 파일과 데이터를 저장할 폴더를 생성합니다.

```bash
sudo mkdir /etc/prometheus
sudo mkdir /var/lib/prometheus
```

### 3.3 바이너리 다운로드 및 압축 해제
공식 릴리스 파일을 받아 압축을 해제합니다.

```bash
cd /tmp
curl -LO https://github.com/prometheus/prometheus/releases/download/v3.9.1/prometheus-3.9.1.linux-amd64.tar.gz
tar xvf prometheus-3.9.1.linux-amd64.tar.gz
cd prometheus-3.9.1.linux-amd64
```

### 3.4 파일 배치 및 권한 설정
실행 파일과 설정 파일을 적절한 위치로 옮기고 소유권을 변경합니다.

```bash
# 실행 파일 이동 및 권한 설정
sudo cp prometheus promtool /usr/local/bin/
sudo chown prometheus:prometheus /usr/local/bin/prometheus
sudo chown prometheus:prometheus /usr/local/bin/promtool

# 설정 파일 이동 및 소유권 변경
sudo cp prometheus.yml /etc/prometheus/
sudo chown -R prometheus:prometheus /etc/prometheus
sudo chown -R prometheus:prometheus /var/lib/prometheus
```

### 3.5 Systemd 서비스 등록
재부팅 시 자동 실행되도록 서비스 파일을 생성합니다.

```bash
sudo vi /etc/systemd/system/prometheus.service
```

**[파일 내용]**

```ini
[Unit]
Description=Prometheus
Wants=network-online.target
After=network-online.target

[Service]
User=prometheus
Group=prometheus
Type=simple
ExecStart=/usr/local/bin/prometheus \
    --config.file /etc/prometheus/prometheus.yml \
    --storage.tsdb.path /var/lib/prometheus/ \

[Install]
WantedBy=multi-user.target
```

### 3.6 서비스 시작 

```bash
# 설정 및 규칙 파일 이상 유무 확인 (추천)
/usr/local/bin/promtool check rules /etc/prometheus/prometheus.yml

# 서비스 실행
sudo systemctl daemon-reload
sudo systemctl enable --now prometheus
```


---

## 4. 설치 확인
웹 브라우저에서 다음 주소로 접속하여 대시보드가 출력되는지 확인합니다.

`http://서버_IP:9090`

설정이 정상적이라면 프로메테우스 웹 인터페이스에 접속되어 쿼리 및 상태 확인이 가능합니다.
